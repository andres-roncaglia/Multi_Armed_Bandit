---
title: "Trabajo Práctico Nº1"
format: pdf
echo: FALSE
message: FALSE
warning: FALSE
---

```{r Carga de librerias}


library(tidyverse)
```



```{r Configuraciones predeterminadas}
set.seed("18122022")

theme_set(theme_bw())

```


```{r}

n <- 1000

ganancias <- NULL
for (i in 1:n) {
  ganancias[i] <- sum(rbinom(366, size = 1, prob = 0.55))
}

promedio_ganancias <- sum(ganancias)/n


tibble(ganancias) |>  
  ggplot() + 
  geom_histogram(aes(x = ganancias), 
                 bins = 30, 
                 fill = "dodgerblue3",
                 color = "black") + 
  labs(x = "Ganancias", y = "Frecuencias") +
  geom_hline(yintercept = 0, color = "black", size = 0.2)


# Problema: los la longitud de las barras cambia segun bins y segun el espacio que tiene para graficarse

```


# Estrategias


## Prior para \theta
```{r}
thetas <- seq(0,1,length.out = 1000)
prior <- dbeta(thetas,2,2)


tibble(thetas, prior) |>  
  ggplot() + 
  geom_line(aes(x = thetas, y = prior), 
            color = "dodgerblue4", 
            linewidth = 1) + 
  labs(x = expression(theta), y = "Probabilidad") +
  geom_hline(yintercept = 0, color = "black", size = 0.2) +
  geom_vline(xintercept = 0, color = "black", size = 0.2)
```

```{r}
source("Estrategias_y_simulacion.R")

a <- simulacion("gcto", 1, 0.2)

df <- data.frame(ganancias = a$Ganancias,
                 maquinas = a$Maquinas) |> 
  rename(Ganancias = Rep_1, Maquinas = Rep_1.1)

medidas <- df |>
  group_by(Maquinas) |> 
  summarise(Tiradas = n(),
            Exitos = sum(Ganancias))

# Parametros de las distribuciones a posteriori y distribuciones a posterior
posterior <- NULL
for(i in 1:3) {
  
  if (is.na(medidas$Tiradas[i])) {
    a <- 2; b <- 2
  } else {
    a <- 2 + medidas$Exitos[i]; b <- 2 + medidas$Tiradas[i] - medidas$Exitos[i]
  }
  
  posterior <- c(posterior, dbeta(thetas, a, b))
}

df_posteriors <- data.frame(x = thetas,
                 posterior,
                 Maquina = rep(c("A","B","C"), each = 1000))

# Grafico posteriors

df_posteriors %>% ggplot() + geom_line(aes(x = x, y = posterior, color = Maquina)) +
  geom_area(aes(x = x, y = posterior, fill = Maquina), alpha = 0.2, position = "identity") +
  labs(x = expression(theta), y = expression("p(y | " ~ theta ~ ")"))


# Grafico ganancias acumuladas
ganancias_acumuladas <- NULL
for (i in seq_along(df$Ganancias)) {
  ganancias_acumuladas[i] <- sum(df$Ganancias[1:i])
}


data.frame(ganancias_acumuladas, Dia = 1:length(ganancias_acumuladas)) %>% 
  ggplot() + geom_line(aes(x = Dia, y = ganancias_acumuladas), linewidth = 0.1) +
  scale_y_continuous(breaks = ceiling(seq(0,max(ganancias_acumuladas), length.out = 10))) +
  geom_vline(xintercept = 0) + 
  geom_hline(yintercept = 0) + 
  labs(y = "Ganancias acumuladas")


# 

data.frame(Maquina = rep(c("A", "B", "C"), times = 2),
           Resultado = factor(rep(c("Exito", "Fracaso"), each = 3), levels = c("Exito", "Fracaso")),
           Cantidad = c(medidas$Exitos, medidas$Tiradas - medidas$Exitos)) %>% 
  ggplot(aes(fill=Resultado, y=Cantidad, x=Maquina)) + 
  geom_bar(position="stack", stat="identity")


```



```{r}
#COmentario de prueba para ver que pasa con el commit
```

